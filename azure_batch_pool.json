{
    "id": "crunchtime-F16s",

    "vmSize": "Standard_F16s",
    "maxTasksPerNode": 1,
    "targetDedicatedNodes": 0,
    "targetLowPriorityNodes": 5,

    "virtualMachineConfiguration": {
        "imageReference": {
            "publisher": "Canonical",
            "sku": "18.04-LTS",
            "offer": "UbuntuServer",
            "version": "latest"
        },
        "nodeAgentSKUId": "batch.node.ubuntu 18.04"
    },

    "networkConfiguration": {
        "subnetId": "/subscriptions/5f6014d1-1ddb-4c14-8ef5-d4aab6636ba2/resourceGroups/cloud_01/providers/Microsoft.Network/virtualNetworks/flamenco-crunch/subnets/default"
    },

    "applicationPackageReferences": [
        {"applicationId": "flamenco-worker"},
        {"applicationId": "blender"},
        {"applicationId": "ffmpeg"}
    ],

    "startTask": {
        "commandLine": "bash -exc 'sudo mkdir -p /mnt/flamenco-resources; sudo mount -t cifs //{STORAGE_ACCOUNT}.file.core.windows.net/flamenco-resources /mnt/flamenco-resources -o vers=3.0,username={STORAGE_ACCOUNT},password={STORAGE_KEY},dir_mode=0777,file_mode=0666,sec=ntlmssp,mfsymlinks; bash -ex /mnt/flamenco-resources/flamenco-worker-startup.sh'",
        "environmentSettings": [
            {"name": "FLAMENCO_AZ_STORAGE_ACCOUNT", "value": "{STORAGE_ACCOUNT}"},
            {"name": "FLAMENCO_AZ_STORAGE_KEY", "value": "{STORAGE_KEY}"}
        ],
        "waitForSuccess": true,
        "userIdentity": {
            "autoUser": {
                "elevationLevel": "Admin",
                "scope": "Pool"
            }
        }
    }
}
